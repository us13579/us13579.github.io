---
layout: single
title:  "SPRING_DI"
categories: 
    - FRAMEWORK
tags: 
    - [2022-04, WEB, SPRING, BACKEND, FRAMEWORK]
sidebar:
    nav: "docs"
---

# 📚 <a style="color:#00adb5">SPRING</a>

<center>
<img width="90%" src="./../../images/spring.png">
</center>
<br>

# 📚 <a style="color:#00adb5">Dependency Injection ( 의존성 주입 )</a>

## <a style="color:#00adb5">Bean</a>
Spring Bean은 기본적으로 *Singleton* 으로 만들어진다. 그러므로 컨테이너가 제공하는 모든 빈의 instance는 동일하다.<br>
컨테이너가 항상 새로운 instance를 반환하게 만들고 싶을 경우 scope를 *prototype* 으로 설정해야한다.

```java
@Service("memberService")
@Scope("singleton")
public class MemberServiceImpl implements MemberService{

    @Override
    public int registerMember(MemberDto memberDto){
        return 0;
    }
}
```
xml bean 설정 ( prototype )
```xml
<bean id="memberService" class="com.test.hello.service2.MemberServiceImpl" scope="prototype"/>
```
<br>
Bean의 생성 범위 지정

- singleton
    - spring container 당 하나의 instance bean만 생성 (default)
- prototype
    - container에 bean을 요청할 때마다 새로운 instance 생성
- request
    - HTTP Request별로 새로운 instance 생성
- session
    - HTTP Session별로 새로운 isntance 생성

<br>
bean 메타 정보의 표현 방식에는 XML Document, Annotation, Java Code 가 있는데 이것들을 통해 BeanDefinition meta data가 되어 IoC Container에 전송된다.<br>
<br>

## <a style="color:#00adb5">Spring Bean</a> 설정

### <a style="color:#00adb5">XML</a>
- XML문서 형태로 빈의 설정 메타 정보를 기술
- <bean> 태그를 통해서 세밀한 제어 가능
<br>

*servlet-context.xml*
```xml
<bean id="memberDao" class="com.test.hello.dao.MemberDaoImpl" />

<bean id="memberService" class="com.test.hello.service2.MemberServiceImpl" scope="prototype" >
    <property name="memberDao" ref="memberDao" />
</bean>
```

### <a style="color:#00adb5">Annotation</a>
- 어플리케이션 규모가 커지고 빈의 개수가 많아질 수록 XML 파일 관리하는 것이 번거롭다.
- 특별한 annotation을 부여해 주면 자동으로 빈 등록이 가능하다.
- "오브젝트 빈 스캐너" 로 "빈 스캐닝"을 통해 자동 등록한다.
    - 빈 스캐너는 기본적으로 클래스 이름을 빈의 아이디로 사용
    - 정확히는 클래스 이름의 첫 글자만 소문자로 바꾼 것을 이용
<br>

```java
@Service
public class MemberServiceImpl implements MemberService{

    // annotation을 사용한 빈 등록 ( Autowired )
    @Autowired
    private MemberDao memberDao;

    @Override
    public int registerMember(MemberDto memberDto){
        return memberDao.registerMember(memberDto);
    }
}
```

<a style="color:red"><strong>Annotation으로 빈을 설정할 경우 반드시 component-scan을 설정해야 한다.</strong></a><br>
servlet-context.xml

```xml
<context:component-scan base-package="com.test.hello.*" />
```

<br>
- Stereotype annotation 종류
    - 빈 자동등록에 사용할 수 있는 annotation
    - 빈 자동인식을 위한 annotation이 여러가지인 이유
        - 계층별로 빈의 특성이나 종류를 구분
        - AOP Pointcut 표현식을 사용하면 특정 annotation이 달린 클래스만 설정 가능
        - 특정 계층의 빈에 부가 기능 부여
<br>
<table>
    <tr>
        <td>Stereotype</td>
        <td>적용 대상</td>
    </tr>
    <tr>
        <td><a style="color:red"><strong>@Repository</strong></a></td>
        <td>Data Access Layer의 DAO 또는 Repository 클래스에 사용<br>
            DataAccessException 자동변환과 같은 AOP의 적용 대상을 선정하기 위해 사용
        </td>
    </tr>
    <tr>
        <td><a style="color:red"><strong>@Service</strong></a></td>
        <td>Service Layer의 클래스에 사용</td>
    </tr>
    <tr>
        <td><a style="color:red"><strong>@Controller</strong></a></td>
        <td>Presentation Layer의 MVC Controller에 사용<br>
            스프링 웹 서블릿에 의해 웹 요청을 처리하는 컨트롤러 빈으로 선정
        </td>
    </tr>
     <tr>
        <td>@Component</td>
        <td>위의 Layer 구분을 적용하기 어려운 일반적인 경우에 설정</td>
    </tr>   
</table>