---
layout: single
title:  "MYBATIS"
categories: 
    - WEB
tags: 
    - [2022-04, WEB, MYBATIS, BACKEND, FRAMEWORK]
sidebar:
    nav: "docs"
---

# ğŸ“š <a style="color:#00adb5">MYBATIS</a>

<center>
<img width="90%" src="./../../images/mybatis.png">
</center>
<br>

# ğŸ“š <a style="color:#00adb5">MYBATIS</a>

## <a style="color:#00adb5">MYBATIS</a> ë€
MyBatisëŠ” <a style="color:red"><strong>Java Object ( DAO )ì™€ SQLë¬¸ ì‚¬ì´ì˜ ìë™ Mapping ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” Persistence Framework ì´ë‹¤. <br>
( ì§€ì†ì„± í”„ë ˆì„ ì›Œí¬ : ìë£Œë¥¼ DBì— ì €ì¥í•˜ëŠ” ê³¼ì •ì„ ë„ì™€ì£¼ê³  ìë™í™”í•˜ëŠ” ë§¤ê°œ SW) , SQL Mapperë¼ê³ ë„ ë¶ˆë¦°ë‹¤. </strong></a><br><br>
SQLë¬¸ì„ ë³„ë„ì˜ íŒŒì¼ë¡œ ë¶„ë¦¬í•´ì„œ ê´€ë¦¬í•œë‹¤.<br><br>
Object (DAO) - SQLë¬¸ ì‚¬ì´ì˜ parameter mapping ì‘ì—…ì„ ìë™ìœ¼ë¡œ í•´ì¤€ë‹¤.<br><br>
MyBatisëŠ” Hibernateë‚˜ JPAì™€ ê°™ì€ ìƒˆë¡œìš´ DB í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„ì„ ìµí˜€ì•¼ í•˜ëŠ” ë¶€ë‹´ ì—†ì´ *ê°œë°œìê°€ ìµìˆ™í•œ SQLì„ ê·¸ëŒ€ë¡œ ì´ìš©í•˜ë©´ì„œ JDBC ì½”ë“œ ì‘ì„±ì˜ ë¶ˆí¸í•¨ì„ ì œê±°í•´ì£¼ê³  ë„ë©”ì¸ ê°ì²´ë‚˜ VO ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œì„ ê°€ëŠ¥í•˜ê²Œ í•´ì¤€ë‹¤.*

## <a style="color:#00adb5">MYBATIS</a> íŠ¹ì§•
- <a style="color:red"><strong>ì‰¬ìš´ ì ‘ê·¼ì„±ê³¼ ê°„ê²°í•œ ì½”ë“œ</strong></a>
    - ê°€ì¥ ê°„ë‹¨í•œ persistence framework 
    - JDBCì˜ ëª¨ë“  ê¸°ëŠ¥ì„ ì œê³µ
    - ìˆ˜ë™ì ì¸ parameter ì„¤ì •ê³¼ Query ê²°ê³¼ì— ëŒ€í•œ mapping êµ¬ë¬¸ì„ ì œê±°
- <a style="color:red"><strong>SQLë¬¸ê³¼ í”„ë¡œê·¸ë˜ë° ì½”ë“œì˜ ë¶„ë¦¬</strong></a>
    - SQLì— ë³€ê²½ì´ ìˆì„ ë•Œë§ˆë‹¤ ìë°” ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì»´íŒŒì¼ í•˜ì§€ ì•Šì•„ë„ ë¨
    - í˜‘ì—… í•  ë•Œ DBAê°€ SQLì„ ì ê²€í•˜ê¸° ìœ ìš©í•˜ë‹¤.
- <a style="color:red"><strong>ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ êµ¬í˜„ê°€ëŠ¥</strong></a>
    - JAVA, C#, .NET, Ruby ...

<br>
<center>
<img width="70%" src="./../../images/mybatis2.png">
</center>
<br>
MyBatisëŠ” <a style="color:red"><strong>DAOì™€ JDBC ì‚¬ì´ì— ìœ„ì¹˜í•´ì„œ ì„œë¡œë¥¼ ë§¤í•‘</strong></a>í•´ì¤€ë‹¤.<br>
ë°‘ì—ì„œ ì–˜ê¸°í•  MyBatis-Springë„ ê°™ì€ ìœ„ì¹˜ì— ì¡´ì¬í•œë‹¤. ( Repository (Mapper) - JDBC )


## <a style="color:#00adb5">MYBATIS</a> ë™ì‘ê³¼ì •
<center>
<img width="70%" src="./../../images/mybatis3.png">
</center>
<br>

1. MyBatis Config íŒŒì¼ì„ ì½ì–´ *SqlSessionFactoryBuilder* ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
2. SqlSessionFactoryBuilder ê°ì²´ë¥¼ ì´ìš©í•´ *SqlSessionFactory* ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
3. ì•± ì‹¤í–‰ ì¤‘ì— CRUD ì²˜ë¦¬ê°€ ë“¤ì–´ì˜¤ë©´ SqlSessionFactoryë¡œ *SqlSession* ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
4. SqlSession ê°ì²´ë¥¼ ì´ìš©í•´ DB ìš”ì²­ì„ í•œ í›„ ê²°ê³¼ê°’ì„ ë°›ì•„ì˜¨ë‹¤.
<br>
MyBatis ConfigëŠ” XMLë¡œ ì‘ì„±í•œë‹¤. íŒŒì¼ì—ëŠ” 4ê°€ì§€ ì •ë³´ë¥¼ ì„¤ì •í•œë‹¤. <br>
ê·¸ë¦¬ê³  dtd ( ë¬¸ì„œ í˜•ì‹ ì •ì˜ )ê°€ ë˜ì–´ìˆìœ¼ë¯€ë¡œ ìˆœì„œëŒ€ë¡œ ì ì–´ì•¼ í•œë‹¤.
- <a style="color:red"><strong>properties</strong></a><br>
í”„ë¡œí¼í‹° íŒŒì¼ì„ ì •ì˜
- <a style="color:red"><strong>typeAliases</strong></a><br>
mapper.xmlì—ì„œ ì‚¬ìš©í•  alias ì„¤ì • ( ì§§ì€ ë‹¨ì–´ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ )
- <a style="color:red"><strong>environments</strong></a><br>
DB ì •ë³´ë¥¼ ì„¤ì •
- <a style="color:red"><strong>mapper</strong></a><br>
ì–´ë–¤ XMl íŒŒì¼ì´ mapper íŒŒì¼ì¸ì§€ ì„¤ì •

<br>

<strong>mybatis-config.xml</strong>

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd">

<configuration>

	<properties resource="dbinfo.properties"/>

	<typeAliases>
		<typeAlias type="com.test.guestbook.model.MemberDto" alias="member" />
		<typeAlias type="com.test.guestbook.model.GuestBookDto" alias="guestbook" />
		<typeAlias type="com.test.guestbook.model.FileInfoDto" alias="fileinfo" />
	</typeAliases>
	
	<environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
            <!-- value ê°’ë“¤ì€ ìœ„ì—ì„œ ê°€ì ¸ì˜¨ dbinfo.propertiesì— ìˆë‹¤ -->
                <property name="driver" value="${driver}"/>
                <property name="url" value="${url}"/>
                <property name="username" value="${dbid}"/>
                <property name="password" value="${dbpwd}"/>
            </dataSource>
        </environment>
    </environments>
    
    <mappers>
		<mapper resource="guestbook.xml" />
		<mapper resource="member.xml" />
	</mappers>
	
</configuration>
```
<br>
<strong>dbinfo.properties</strong>

```
driver=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/testweb?serverTimezone=UTC&useUniCode=yes&characterEncoding=UTF-8
dbid=root
dbpwd=1234
```

<br>

mapperì—ì„œ ì •ì˜í•œ *member.xml* ë§¤í¼ íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
<br><br>
<strong>member.xml</strong>

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<!-- 1. ì–´ë””ì„œ ì‚¬ìš©í•  ê²ƒì¸ê°€ ëª…ì‹œ ( guestbookì—ë„ registerê°€ ìˆì„ ìˆ˜ ìˆë‹¤ ) -->
<mapper namespace="com.test.guestbook.model.dao.MemberDao">

<!-- 2. idëŠ” ë©”ì„œë“œì˜ ì´ë¦„ , 3. parameterTypeì€  configì—ì„œ alias í•´ì¤€ íŒŒì¼ ( Dto ì—°ê²° ) -->
<!-- 4. query ë¬¸ì„ ë§Œë“¤ì–´ ì¤€ë‹¤. ì˜ˆì „PreparedStatement ì— ë“¤ì–´ê°ˆ ê°’ë“¤ì€  #{} ë¡œ ëŒ€ì²´í•˜ê³  , getter. setterì˜ propertyë¡œ ì„¤ì •í•˜ë©´ ëœë‹¤
		values ê°’ë“¤ì€ getterê°€ ëœë‹¤.	
		-->
	<insert id="registerMember" parameterType="member">
	insert into test_member (userid, username, userpwd, email, joindate)
	<!-- dtoê°€ ê°€ì§€ê³  ìˆëŠ” property -->
	values(#{userId}, #{userName}, #{userPwd}, #{email}, now())
	</insert>

<!-- javaê°€ ì œê³µí•´ì£¼ëŠ” wrapper classëŠ” ë§¨ì²«ê¸€ìë¥¼ ì†Œë¬¸ìë¡œ ë°”ê¾¸ë©´ ëœë‹¤ -->
<!-- ì–»ì–´ì˜¨ê±° ìˆìœ¼ë©´ ì „ë‹¬ - resultType -->
<!-- select ì˜†ì— ê°’ë“¤ì€ setter ê°€ ëœë‹¤. -->
	<select id="login" parameterType="map" resultType="member">
	<!-- ì´ë¦„ì´ ë‹¤ë¥´ë©´ as ì¤˜ì•¼í•œë‹¤ ( form, dto, db ) -->
	select username, userid, email
	from test_member
	<!-- mapì˜ key ê°’ -->
	where userid = #{userId} and userpwd = #{userPwd}
	</select>

</mapper>
```

<br>

ë‹¤ìŒì€ *SqlSessionFactoryBuilder* ì™€ *SqlSessionFactory* ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œì´ë‹¤.
<br>

ìœ„ì˜ MyBatis ì„¤ì • íŒŒì¼ì„ ì½ì–´ *SqlSessionFactoryBuilder* ë¥¼ ìƒì„±í•œ í›„ ì´ê²ƒìœ¼ë¡œ *SqlSessionFactory* ë¥¼ ìƒì„±í•˜ì—¬ *SqlSession* ê°ì²´ë¥¼ ìƒì„±í•´ ì‚¬ìš©í•˜ê³  ìˆë‹¤.
<br>
<strong>SqlMapConfig.java</strong>

```java
public class SqlMapConfig {
	
	private static SqlSessionFactory factory;

	// íŒ©í† ë¦¬ ìƒì„± 
	static {
		try {
			String resource = "mybatis-config.xml";
			Reader reader = Resources.getResourceAsReader(resource);
			factory = new SqlSessionFactoryBuilder().build(reader);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// sql ì„¸ì…˜ì„ ë§Œë“¤ì–´ ë‚¸ë‹¤
	public static SqlSession getSqlSession() {
		return factory.openSession();
	}
	
}
```

<br>

ì‹¤ì œ SqlSession ë©”ì„œë“œë¥¼ íŒŒë¼ë¯¸í„°ë¡œ *mapper id* ì™€ *mapper íŒŒë¼ë¯¸í„°* ë¥¼ ë„˜ê¸´ë‹¤.<br>
<strong>MemberDaoImpl.java</strong>

```java
@Repository
public class MemberDaoImpl implements MemberDao {

	private final String NAMESPACE = "com.test.guestbook.model.dao.MemberDao.";

// mapper.xml ì—ì„œ idë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. 
	@Override
	public void registerMember(MemberDto memberDto) throws SQLException {
		// sqlmapconfigì— ìˆë˜ ê±° ì‚¬ìš©
		try (SqlSession sqlSession = SqlMapConfig.getSqlSession()) {
			sqlSession.insert(NAMESPACE + "registerMember", memberDto);
			sqlSession.commit();
		}
	}

	@Override
	public MemberDto login(Map<String, String> map) throws SQLException {
		try (SqlSession sqlSession = SqlMapConfig.getSqlSession()) {
			return sqlSession.selectOne(NAMESPACE + "login", map);
		}
	}
}
```

## <a style="color:#00adb5">MyBatis - Spring</a> ë€
MyBatis-Springì€ <a style="color:red"><strong>MyBatisë¥¼ Spring Frameworkì— ë…¹ì—¬ë‚´ ì¢€ ë” ì‰½ê²Œ ì‚¬ìš©í•˜ê³ ìí•˜ëŠ” ì—°ë™ ëª¨ë“ˆ</strong></a>ì´ë‹¤.<br>

MyBatis-Springì—ì„œëŠ” *Spring Frameworkì˜ Bean* ìœ¼ë¡œ SqlSessionFactoryBeanê³¼ SqlSessionì„ ë“±ë¡í•œë‹¤.<br>
*SqlSessionTemplate* ëŠ” *SqlSessionì˜ êµ¬í˜„ì²´* ì´ë‹¤.

<br>
<strong>root-context.xml</strong>

```xml
<!-- ë°‘ì— ê³¼ì •ì€ SqlMapConfig.javaì—ì„œ ì§„í–‰ë˜ë˜ ê³¼ì •
	ë¨¼ì € mybatis-config.xmlì„ ë°›ì•„ì™€ factoryë¥¼ ë§Œë“¤ê³  ê·¸ factoryë¥¼ ì´ìš©í•´ sql ì„¸ì…˜ì„ ë§Œë“¤ì–´ ë‚¸ë‹¤.
	mybatis-config.xml ì—ì„œëŠ” db ì—°ê²°ê³¼ ì“¸ íŒŒì¼ ì„¤ì •, alias ë“±ì„ ì§„í–‰í•œë‹¤.
	ê·¸ê²ƒì„ ë‹¤ ë°‘ì— êµ¬í˜„í–ˆê¸° ë•Œë¬¸ì— ê¸°ì¡´ SqlMapConfig.javaì™€ mybatis-config.xmlëŠ” ì—†ì–´ë„ ëœë‹¤.
 	-->

	<!-- mybatis-config.xml ì—ì„œ enviornments ë¶€ë¶„ -->
	<bean id="ds" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName" value="java:comp/env/jdbc/ssafy"></property>
	</bean>


	<!-- mybatis -->
	<!-- SqlMapConfig.java ë¶€ë¶„ ìƒì„± -->
	<!-- factory ë§Œë“¤ì–´ì£¼ê¸° -->
	<bean id="sqlSessionFactoryBean" class="org.mybatis.spring.SqlSessionFactoryBean">
		<!-- ìœ„ì— ì„ ì–¸í•œ ds ì°¸ì¡° -->
		<property name="dataSource" ref="ds" />
		<!-- mybatis-config.xml ì—ì„œ mappers ë¶€ë¶„ -->
		<!-- mapperë¼ëŠ” í´ë” ë°‘ì— ëª¨ë“  xmlì„ ì½ì–´ ì˜¤ê² ë‹¤ 	mapperê°€ ì–´ë”¨ëŠëƒ~	-->
		<property name="mapperLocations" value="classpath:mapper/*.xml" />
		
		<!-- mybatis-config.xml ì—ì„œ typeAliases ë¶€ë¶„ -->
		<!-- configê°€ ì–´ë”¨ëŠëƒ~  -->
		<!-- í´ë” ê²½ë¡œ ì§€ì •í•´ì„œ ì—°ê²° -->
		<!-- <property name="configLocation" value="classpath:mybatis-config.xml"/> -->
		<!-- ì—¬ê¸°ì„œ package ì„ ì–¸ -> mybatis-config.xmlê°€ ì—†ì–´ë„ëœë‹¤ -->
		<property name="typeAliasesPackage" value="com.ssafy.guestbook.model"/>
	</bean>
	
	<!-- SqlMapConfig.java ë¶€ë¶„ ìƒì„± -->
	<!-- default ê°’ì´ ì—†ì–´ì„œ ë°˜ë“œì‹œ ìƒì„±ìë¥¼ ê°€ì ¸ê°€ì•¼í•œë‹¤ -->
	<!-- factoryë¥¼ ê°€ì§€ê³  SqlSessionì„ ë§Œë“¤ì–´ë¼ -->
	<bean id="sqlSession" class="org.mybatis.spring.SqlSessionTemplate">
		<constructor-arg ref="sqlSessionFactoryBean"/>
	</bean>
```

<br>
mapper ì„¤ì • íŒŒì¼<br><br>

<strong>member.xml</strong>

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.test.guestbook.model.mapper.MemberMapper">

	<insert id="registerMember" parameterType="MemberDto">
		insert into ssafy_member (userid, username, userpwd, email, joindate)
		values (#{userId}, #{userName}, #{userPwd}, #{email}, now())
	</insert>

	<select id="login" parameterType="map" resultType="MemberDto">
		select username, userid, email
		from ssafy_member
		where userid = #{userId} and userpwd = #{userPwd}
	</select>
	
</mapper>
```

<br>
ì´ì œ ì¤€ë¹„ë¥¼ ë‹¤ ë§ˆì¹˜ê³  mapper interfaceì— ê°ì²´ë¥¼ êµ³ì´ êµ¬í˜„ ì•ˆí•˜ê³  ë§Œë“¤ì–´ì£¼ëŠ” ì´ìœ ëŠ” í•´ë‹¹ interfaceê°€ ë§¤í•‘ë˜ëŠ” mapper.xmlì„ ì•Œì•„ì„œ ì°¾ì•„ì¤€ë‹¤.
<br>

<strong>MemberMapper.java</strong>

```java
public interface MemberMapper {

	int idCheck(String id) throws Exception;
	void registerMember(MemberDto memberDto) throws Exception;
	MemberDto login(Map<String, String> map) throws Exception;
}
```